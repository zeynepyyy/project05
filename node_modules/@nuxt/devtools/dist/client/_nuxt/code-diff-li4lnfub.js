import{_ as k}from"./ncode-block-esxkr86l.js";import{ao as E}from"#entry";import{p as I,q as T,k as j,D as y,W as q,X as M}from"./vendor/json-editor-vue-ho2zu772.js";class W{diff(e,t,n={}){let o;typeof n=="function"?(o=n,n={}):"callback"in n&&(o=n.callback);const d=this.castInput(e,n),u=this.castInput(t,n),l=this.removeEmpty(this.tokenize(d,n)),s=this.removeEmpty(this.tokenize(u,n));return this.diffWithOptionsObj(l,s,n,o)}diffWithOptionsObj(e,t,n,o){var d;const u=c=>{if(c=this.postProcess(c,n),o){setTimeout(function(){o(c)},0);return}else return c},l=t.length,s=e.length;let r=1,i=l+s;n.maxEditLength!=null&&(i=Math.min(i,n.maxEditLength));const p=(d=n.timeout)!==null&&d!==void 0?d:1/0,f=Date.now()+p,a=[{oldPos:-1,lastComponent:void 0}];let h=this.extractCommon(a[0],t,e,0,n);if(a[0].oldPos+1>=s&&h+1>=l)return u(this.buildValues(a[0].lastComponent,t,e));let g=-1/0,_=1/0;const w=()=>{for(let c=Math.max(g,-r);c<=Math.min(_,r);c+=2){let C;const P=a[c-1],v=a[c+1];P&&(a[c-1]=void 0);let x=!1;if(v){const D=v.oldPos-c;x=v&&0<=D&&D<l}const L=P&&P.oldPos+1<s;if(!x&&!L){a[c]=void 0;continue}if(!L||x&&P.oldPos<v.oldPos?C=this.addToPath(v,!0,!1,0,n):C=this.addToPath(P,!1,!0,1,n),h=this.extractCommon(C,t,e,c,n),C.oldPos+1>=s&&h+1>=l)return u(this.buildValues(C.lastComponent,t,e))||!0;a[c]=C,C.oldPos+1>=s&&(_=Math.min(_,c-1)),h+1>=l&&(g=Math.max(g,c+1))}r++};if(o)(function c(){setTimeout(function(){if(r>i||Date.now()>f)return o(void 0);w()||c()},0)})();else for(;r<=i&&Date.now()<=f;){const c=w();if(c)return c}}addToPath(e,t,n,o,d){const u=e.lastComponent;return u&&!d.oneChangePerToken&&u.added===t&&u.removed===n?{oldPos:e.oldPos+o,lastComponent:{count:u.count+1,added:t,removed:n,previousComponent:u.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:t,removed:n,previousComponent:u}}}extractCommon(e,t,n,o,d){const u=t.length,l=n.length;let s=e.oldPos,r=s-o,i=0;for(;r+1<u&&s+1<l&&this.equals(n[s+1],t[r+1],d);)r++,s++,i++,d.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return i&&!d.oneChangePerToken&&(e.lastComponent={count:i,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=s,r}equals(e,t,n){return n.comparator?n.comparator(e,t):e===t||!!n.ignoreCase&&e.toLowerCase()===t.toLowerCase()}removeEmpty(e){const t=[];for(let n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}castInput(e,t){return e}tokenize(e,t){return Array.from(e)}join(e){return e.join("")}postProcess(e,t){return e}get useLongestToken(){return!1}buildValues(e,t,n){const o=[];let d;for(;e;)o.push(e),d=e.previousComponent,delete e.previousComponent,e=d;o.reverse();const u=o.length;let l=0,s=0,r=0;for(;l<u;l++){const i=o[l];if(i.removed)i.value=this.join(n.slice(r,r+i.count)),r+=i.count;else{if(!i.added&&this.useLongestToken){let p=t.slice(s,s+i.count);p=p.map(function(f,a){const h=n[r+a];return h.length>f.length?h:f}),i.value=this.join(p)}else i.value=this.join(t.slice(s,s+i.count));s+=i.count,i.added||(r+=i.count)}}return o}}class z extends W{constructor(){super(...arguments),this.tokenize=V}equals(e,t,n){return n.ignoreWhitespace?((!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim()),(!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(e.endsWith(`
`)&&(e=e.slice(0,-1)),t.endsWith(`
`)&&(t=t.slice(0,-1))),super.equals(e,t,n)}}const A=new z;function O(m,e,t){return A.diff(m,e,t)}function V(m,e){e.stripTrailingCr&&(m=m.replace(/\r\n/g,`
`));const t=[],n=m.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let o=0;o<n.length;o++){const d=n[o];o%2&&!e.newlineIsToken?t[t.length-1]+=d:t.push(d)}return t}const b=I({__name:"CodeDiff",props:{from:{},to:{},lang:{}},setup(m){const e=m;function t(l,s){const r=O(l.trim(),s.trim()),i=[],p=[],f=[];for(const a of r){const h=a.value.trimEnd().split(`
`);for(const g of h)a.added?(i.push(f.length),f.push(g)):(a.removed&&p.push(f.length),f.push(g))}return{added:i,removed:p,result:f.join(`
`)}}const n=T(()=>t(e.from,e.to));function o(l){let s=0;return l.replace(/class="shiki/,'class="shiki diff').replace(/class="line"/g,r=>(s++,n.value.added.includes(s-1)?'class="line line-added"':n.value.removed.includes(s-1)?'class="line line-removed"':r))}const d=j();y(u);function u(){const l=E(d);l&&l.querySelector(".line-added,.line-removed")?.scrollIntoView()}return(l,s)=>{const r=k;return M(),q(r,{ref_key:"elRef",ref:d,code:n.value.result,lang:m.lang,"transform-rendered":o,onLoaded:u},null,8,["code","lang"])}}}),S=Object.assign(b,{__name:"CodeDiff"});export{S as _};
